<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ú–æ—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ ‚Äî –ò–Ω–≥–æ—Å—Å—Ç—Ä–∞—Ö</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- –ì–µ—Ä–æ–π—Å–∫–∞—è —Å–µ–∫—Ü–∏—è -->
  <header class="hero-section">
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <div class="hero-logo">
        <div class="logo-icon">üèõÔ∏è</div>
        <h1 class="hero-title">–ò–ù–ì–û–°–°–¢–†–ê–•</h1>
        <div class="hero-subtitle">–ò–º—É—â–µ—Å—Ç–≤–æ –§–∏–∑–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü</div>
      </div>
    </div>
    <div class="hero-decoration">
      <div class="decoration-element"></div>
      <div class="decoration-element"></div>
      <div class="decoration-element"></div>
    </div>
  </header>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <main class="main-content">
    <div class="container">
      <a href="index.html" class="back-button">
        <span>‚Üê</span> <span>–ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É –ø—Ä–æ–¥—É–∫—Ç–æ–≤</span>
      </a>
      <div class="header"><h1 style="margin:0">–ú–æ—è –∫–≤–∞—Ä—Ç–∏—Ä–∞</h1></div>

    <div class="grid" style="margin-top:14px">
      <div class="card">
        <div class="h2">–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞</div>
        <div class="small-block">
          –ü—Ä–æ–¥—É–∫—Ç-–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø–æ –∑–∞—â–∏—Ç–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã (–±–µ–∑ –æ—Ü–µ–Ω–∫–∏/–æ—Å–º–æ—Ç—Ä–∞). –ú–æ–∂–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã, –ª–∏–º–∏—Ç—ã, —Å–∏—Å—Ç–µ–º—É –≤–æ–∑–º–µ—â–µ–Ω–∏—è –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≥—Ä—É–ø–ø—ã —Ä–∏—Å–∫–æ–≤.
        </div>

        <div class="box controls" style="margin-top:12px">
          <div class="h2">–°–∏—Å—Ç–µ–º–∞ –≤–æ–∑–º–µ—â–µ–Ω–∏—è</div>
          <label><input type="radio" name="recomp" value="old" checked> –°–¢–ê–†–û–ï –ó–ê –°–¢–ê–†–û–ï</label>
          <label><input type="radio" name="recomp" value="new"> –ù–û–í–û–ï –ó–ê –°–¢–ê–†–û–ï</label>
        </div>

        <div class="box">
          <div class="h2">–û–±—ä–µ–∫—Ç—ã —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è</div>

          <div class="object-item">
            <label class="object-label"><input type="checkbox" id="chk_cons"> <span class="object-name">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã</span></label>
            <div id="blk_cons" class="object-details" style="display:none">
              <div class="input-field">
                <label for="sum_cons" class="input-label-small">–õ–∏–º–∏—Ç (‚ÇΩ):</label>
                <input id="sum_cons" type="number" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" class="sum-input">
              </div>
              <div class="note-text">–í —Ä–∞—Å—á–µ—Ç–µ –ø–æ–∫–∞–∑–∞–Ω–æ —Ç–æ–ª—å–∫–æ –∏—Ç–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî —Ç–∞—Ä–∏—Ñ —Å–∫—Ä—ã—Ç</div>
            </div>
          </div>

          <div class="object-item">
            <label class="object-label"><input type="checkbox" id="chk_finish"> <span class="object-name">–û—Ç–¥–µ–ª–∫–∞ –∏ –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</span></label>
            <div id="blk_finish" class="object-details" style="display:none">
              <div class="input-field">
                <label for="sum_finish" class="input-label-small">–õ–∏–º–∏—Ç (‚ÇΩ):</label>
                <input id="sum_finish" type="number" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" class="sum-input">
              </div>
              <div class="risk-groups">
                <label class="risk-label"><input type="checkbox" id="fin_gr1"> –ì—Ä—É–ø–ø–∞ —Ä–∏—Å–∫–æ–≤ 1 <span class="tooltip" title="–ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ –æ—Å–∞–¥–∫–∏, –¥–∞–≤–ª–µ–Ω–∏–µ —Å–Ω–µ–≥–∞, –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ –≤–æ–¥—ã">?</span></label>
                <div class="risk-input" id="fin_gr1_input" style="display:none">
                  <label for="sum_fin_gr1" class="input-label-small">–õ–∏–º–∏—Ç –¥–ª—è –≥—Ä—É–ø–ø—ã (‚ÇΩ):</label>
                  <input id="sum_fin_gr1" type="number" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" class="sum-input">
                </div>

                <label class="risk-label"><input type="checkbox" id="fin_gr23"> –ì—Ä—É–ø–ø–∞ —Ä–∏—Å–∫–æ–≤ 2+3 <span class="tooltip" title="–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è –≤—Å–ª–µ–¥—Å—Ç–≤–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è –Ω–æ—Ä–º –ø–æ–∂–∞—Ä–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º, –¥–µ—Ñ–µ–∫—Ç–æ–≤ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞">?</span></label>
                <div class="risk-input" id="fin_gr23_input" style="display:none">
                  <label for="sum_fin_gr23" class="input-label-small">–õ–∏–º–∏—Ç –¥–ª—è –≥—Ä—É–ø–ø—ã (‚ÇΩ):</label>
                  <input id="sum_fin_gr23" type="number" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" class="sum-input">
                </div>
              </div>
            </div>
          </div>

          <div class="object-item">
            <label class="object-label"><input type="checkbox" id="chk_mov"> <span class="object-name">–î–≤–∏–∂–∏–º–æ–µ –∏–º—É—â–µ—Å—Ç–≤–æ</span></label>
            <div id="blk_mov" class="object-details" style="display:none">
              <div class="input-field">
                <label for="sum_mov" class="input-label-small">–õ–∏–º–∏—Ç (‚ÇΩ):</label>
                <input id="sum_mov" type="number" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" class="sum-input">
              </div>
              <div class="risk-groups">
                <label class="risk-label"><input type="checkbox" id="mov_gr1"> –ì—Ä—É–ø–ø–∞ —Ä–∏—Å–∫–æ–≤ 1</label>
                <div class="risk-input" id="mov_gr1_input" style="display:none">
                  <label for="sum_mov_gr1" class="input-label-small">–õ–∏–º–∏—Ç –¥–ª—è –≥—Ä—É–ø–ø—ã (‚ÇΩ):</label>
                  <input id="sum_mov_gr1" type="number" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" class="sum-input">
                </div>

                <label class="risk-label"><input type="checkbox" id="mov_gr23"> –ì—Ä—É–ø–ø–∞ —Ä–∏—Å–∫–æ–≤ 2+3</label>
                <div class="risk-input" id="mov_gr23_input" style="display:none">
                  <label for="sum_mov_gr23" class="input-label-small">–õ–∏–º–∏—Ç –¥–ª—è –≥—Ä—É–ø–ø—ã (‚ÇΩ):</label>
                  <input id="sum_mov_gr23" type="number" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" class="sum-input">
                </div>
              </div>
            </div>
          </div>

          <div class="object-item">
            <label class="object-label"><input type="checkbox" id="chk_go"> <span class="object-name">–ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å (–ì–û)</span></label>
            <div id="blk_go" class="object-details" style="display:none">
              <div class="input-field">
                <label for="sum_go" class="input-label-small">–õ–∏–º–∏—Ç (‚ÇΩ):</label>
                <input id="sum_go" type="number" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" class="sum-input">
              </div>
            </div>
          </div>

          <div class="info-box" style="margin-top:20px">
            <div class="info-title"><span class="tooltip">?</span> –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –≥—Ä—É–ø–ø–æ–≤—ã–º —Ä–∏—Å–∫–∞–º:</div>
            <div class="info-content">
              <strong>–ì—Ä—É–ø–ø–∞ —Ä–∏—Å–∫–æ–≤ 1</strong> ‚Äî –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ –æ—Å–∞–¥–∫–∏; –¥–∞–≤–ª–µ–Ω–∏–µ —Å–Ω–µ–≥–∞; –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ –≤–æ–¥—ã/–∂–∏–¥–∫–æ—Å—Ç–µ–π –∏–∑ —Å–∏—Å—Ç–µ–º –≤–Ω–µ —É—á–∞—Å—Ç–∫–∞.<br>
              <strong>–ì—Ä—É–ø–ø–∞ —Ä–∏—Å–∫–æ–≤ 2+3</strong> ‚Äî –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è –≤—Å–ª–µ–¥—Å—Ç–≤–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è –Ω–æ—Ä–º –ø–æ–∂–∞—Ä–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º, –¥–µ—Ñ–µ–∫—Ç–æ–≤ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ —Ç.–ø.
            </div>
          </div>

        </div>

      </div>

      <div class="card">
        <div class="h2">–ò—Ç–æ–≥ —Ä–∞—Å—á—ë—Ç–∞</div>
        <div id="error1" class="error"></div>
        <table class="table" id="res_table">
          <thead><tr><th>–ó–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–æ</th><th style="text-align:right">–°—Ç–æ–∏–º–æ—Å—Ç—å, ‚ÇΩ</th></tr></thead>
          <tbody id="res_body"></tbody>
        </table>
        <div class="total">–ò—Ç–æ–≥–æ: <span id="res_total">0</span> ‚ÇΩ</div>

        <div class="box" style="margin-top:12px">
          <div class="h2">–†–∏—Å–∫–∏ (–ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç)</div>
          <div class="small-block">
            ‚ñ∫ –ü–æ–∂–∞—Ä, –≤–∑—Ä—ã–≤, –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –≤–æ–¥–æ–π, –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ, –∫—Ä–∞–∂–∞, –≥—Ä–∞–±–µ–∂, —Ä–∞–∑–±–æ–π, —É–º—ã—à–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, –≤—Ä–µ–¥ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã —Ç—Ä–µ—Ç—å–∏—Ö –ª–∏—Ü, —Å—Ç–∏—Ö–∏–π–Ω–æ–µ –±–µ–¥—Å—Ç–≤–∏–µ, —Ç–µ—Ä–∞–∫—Ç, –∫–æ—Ä–æ—Ç–∫–æ–µ –∑–∞–º—ã–∫–∞–Ω–∏–µ.<br>
            ‚ñ∫ ¬´–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã—Ö —Å–∏—Å—Ç–µ–º¬ª ‚Äî –∫–∞–∫ –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö.
          </div>
        </div>

        <div class="box">
          <div class="h2">–ó–∞–ø—Ä–µ—Ç–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã</div>
          <div class="restrictions-list">
            <div class="restriction-item">‚Ä¢ –ó–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –†–§, –û–ø–∞—Å–Ω—ã–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏</div>
            <div class="restriction-item">‚Ä¢ –ò–∑–Ω–æ—Å 70%</div>
            <div class="restriction-item">‚Ä¢ –ê–≤–∞—Ä–∏–π–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –ø–æ–¥ —Å–Ω–æ—Å, ¬´—Ä–µ–Ω–æ–≤–∞—Ü–∏—è¬ª –∏ –ø–æ–¥–≤–∞–ª—å–Ω—ã–µ –ø–æ–º–µ—â–µ–Ω–∏—è</div>
            <div class="restriction-item">‚Ä¢ –í—ã–≤–µ–¥–µ–Ω–Ω—ã–µ –∏–∑ –∂–∏–ª–æ–≥–æ —Ñ–æ–Ω–¥–∞</div>
            <div class="restriction-item">‚Ä¢ –î–ª—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö —Ü–µ–ª–µ–π, –≤ –∞—Ä–µ–Ω–¥–µ &lt; 1 –º–µ—Å.</div>
            <div class="restriction-item">‚Ä¢ –ö–≤–∞—Ä—Ç–∏—Ä—ã –≤ –¥–µ—Ä–µ–≤—è–Ω–Ω–æ–º –¥–æ–º–µ, –≤ –¥–æ–º–µ —Å –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–º–∏ –∏–ª–∏ —Å–º–µ—à–∞–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è–º–∏</div>
            <div class="restriction-item">‚Ä¢ –ë–∞—Ä–∞–∫–∏, —Å—Ç—Ä–æ–µ–Ω–∏—è –±–∞—Ä–∞—á–Ω–æ–≥–æ —Ç–∏–ø–∞</div>
            <div class="restriction-item">‚Ä¢ –ù–∞–ª–∏—á–Ω—ã–µ –¥–µ–Ω—å–≥–∏, –¥—Ä–∞–≥–º–µ—Ç–∞–ª–ª—ã, —Ü–µ–Ω–Ω—ã–µ –±—É–º–∞–≥–∏, —Ä–∞—Å—Ö–æ–¥–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –≤–∑—Ä—ã–≤—á–∞—Ç—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞, –¥–≤–∏–∂–∏–º–æ–µ –∏–º—É—â–µ—Å—Ç–≤–æ –≤ –Ω–µ—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏</div>
            <div class="restriction-item">‚Ä¢ –ö–≤–∞—Ä—Ç–∏—Ä—ã –≤ –¥–µ—Ä–µ–≤—è–Ω–Ω–æ–º –¥–æ–º–µ, –≤ –¥–æ–º–µ —Å –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–º–∏ –∏–ª–∏ —Å–º–µ—à–∞–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è–º–∏</div>
            <div class="restriction-item">‚Ä¢ –û—Ç–¥–µ–ª–∫–∞ –Ω–∞ —Å—Ç–∞–¥–∏–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ—Ä–µ–º–æ–Ω—Ç–Ω—ã—Ö —Ä–∞–±–æ—Ç</div>
            <div class="restriction-item">‚Ä¢ –ö–≤–∞—Ä—Ç–∏—Ä—ã/ –∫–æ–º–Ω–∞—Ç—ã –∫–æ–º–º—É–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–∏–ø–∞</div>
            <div class="restriction-item">‚Ä¢ –î–ò –ø–æ –ø–µ—Ä–µ—á–Ω—é</div>
            <div class="restriction-item">‚Ä¢ –ö–≤–∞—Ä—Ç–∏—Ä—ã —Å –ø–µ—á–Ω—ã–º –æ—Ç–æ–ø–ª–µ–Ω–∏–µ–º</div>
            <div class="restriction-item">‚Ä¢ –ê–ø–ø–∞—Ä–∞—Ç—É—Ä–∞ –∏ —Ç–µ—Ö–Ω–∏–∫–∞ –≤ –Ω–µ—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏</div>
            <div class="restriction-item">‚Ä¢ –ò–º—É—â–µ—Å—Ç–≤–æ –ø–æ–¥–ª–µ–∂–∞—â–µ–µ –∞—Ä–µ—Å—Ç—É, –∫–æ–Ω—Ñ–∏—Å–∫–∞—Ü–∏–∏ –∏ —Ç.–ø.</div>
            <div class="restriction-item">‚Ä¢ –ß–∞—Å—Ç–∏ –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤—ã–≥–æ–¥–æ–ø—Ä–∏–æ–±—Ä–µ—Ç–∞—Ç–µ–ª—è</div>
          </div>
        </div>

      </div>
    </div>
  </main>

  <script type="module">
    import { T_MOYA } from './tariffs.moyakvartira.js';

    // helpers
    const fmt = n => new Intl.NumberFormat('ru-RU').format(Math.round(n));

    // UI elements
    const chk_cons = document.getElementById('chk_cons');
    const chk_finish = document.getElementById('chk_finish');
    const chk_mov = document.getElementById('chk_mov');
    const chk_go = document.getElementById('chk_go');

    const blk_cons = document.getElementById('blk_cons');
    const blk_finish = document.getElementById('blk_finish');
    const blk_mov = document.getElementById('blk_mov');
    const blk_go = document.getElementById('blk_go');

    const sum_cons = document.getElementById('sum_cons');
    const sum_finish = document.getElementById('sum_finish');
    const sum_mov = document.getElementById('sum_mov');
    const sum_go = document.getElementById('sum_go');

    const fin_gr1 = document.getElementById('fin_gr1');
    const fin_gr23 = document.getElementById('fin_gr23');
    const mov_gr1 = document.getElementById('mov_gr1');
    const mov_gr23 = document.getElementById('mov_gr23');

    const sum_fin_gr1 = document.getElementById('sum_fin_gr1');
    const sum_fin_gr23 = document.getElementById('sum_fin_gr23');
    const sum_mov_gr1 = document.getElementById('sum_mov_gr1');
    const sum_mov_gr23 = document.getElementById('sum_mov_gr23');

    const res_body = document.getElementById('res_body');
    const res_total = document.getElementById('res_total');
    const error1 = document.getElementById('error1');

    // Elements for risk groups
    const fin_gr1_input = document.getElementById('fin_gr1_input');
    const fin_gr23_input = document.getElementById('fin_gr23_input');
    const mov_gr1_input = document.getElementById('mov_gr1_input');
    const mov_gr23_input = document.getElementById('mov_gr23_input');

    function showHide(box, checked){
      box.style.display = checked ? 'block' : 'none';
    }

    // events
    [chk_cons, chk_finish, chk_mov, chk_go].forEach(cb => cb.addEventListener('change', e => {
      showHide(blk_cons, chk_cons.checked);
      showHide(blk_finish, chk_finish.checked);
      showHide(blk_mov, chk_mov.checked);
      showHide(blk_go, chk_go.checked);
      recalc();
    }));

    // Risk groups toggle
    fin_gr1.addEventListener('change', () => {
      showHide(fin_gr1_input, fin_gr1.checked);
      recalc();
    });
    fin_gr23.addEventListener('change', () => {
      showHide(fin_gr23_input, fin_gr23.checked);
      recalc();
    });
    mov_gr1.addEventListener('change', () => {
      showHide(mov_gr1_input, mov_gr1.checked);
      recalc();
    });
    mov_gr23.addEventListener('change', () => {
      showHide(mov_gr23_input, mov_gr23.checked);
      recalc();
    });

    [sum_cons, sum_finish, sum_mov, sum_go,
     sum_fin_gr1, sum_fin_gr23, sum_mov_gr1, sum_mov_gr23].forEach(el => el && el.addEventListener('input', recalc));
    document.getElementsByName('recomp').forEach(r => r.addEventListener('change', recalc));

    // helpers for ranges
    function rateFromTable(table, sum){
      const t = table.find(r => sum >= r.min && sum <= r.max);
      return t ? t.rate : 0;
    }

    function recalc(){
      error1.textContent = '';
      res_body.innerHTML = '';
      let total = 0;
      const selected = [chk_cons.checked, chk_finish.checked, chk_mov.checked, chk_go.checked].some(x => x);

      if (!selected) { error1.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç'; res_total.textContent = '0'; return; }

      const recomp = document.querySelector('input[name="recomp"]:checked')?.value === 'new';

      // constructive
      if (chk_cons.checked){
        const s = Number(sum_cons.value || 0);
        if (s <= 0) { error1.textContent = '–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤'; return; }
        // tariff logic hidden from user
        const others = (chk_finish.checked || chk_mov.checked || chk_go.checked);
        const rate = others ? T_MOYA.constructive.withOthers : T_MOYA.constructive.only;
        let prem = s * rate;
        // apply new-for-old only to constructive
        if (recomp) prem = prem * 1.1;
        total += prem;
        res_body.insertAdjacentHTML('beforeend', `<tr><td>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã</td><td class="right">${fmt(prem)}</td></tr>`);
        res_body.insertAdjacentHTML('beforeend', `<tr><td class="small-block">‚Äî –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–∞–∫–µ—Ç</td><td class="right">${fmt(prem)}</td></tr>`);
      }

      // finish
      if (chk_finish.checked){
        const s = Number(sum_finish.value || 0);
        if (s <= 0) { error1.textContent = '–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –æ—Ç–¥–µ–ª–∫–∏'; return; }
        const rate = rateFromTable(T_MOYA.finish, s);
        if (!rate) { error1.textContent = '–û—Ç–¥–µ–ª–∫–∞: —Å—É–º–º–∞ –≤–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤'; return; }
        let prem = s * rate;
        // apply new-for-old to finish
        if (recomp) prem = prem * 1.1;
        total += prem;
        res_body.insertAdjacentHTML('beforeend', `<tr><td>–û—Ç–¥–µ–ª–∫–∞ –∏ –∏–Ω–∂. –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</td><td class="right">${fmt(prem)}</td></tr>`);
        // group risks for finish
        if (fin_gr1.checked){
          const lim = Number(sum_fin_gr1.value || s);
          const grPrem = lim * T_MOYA.risks.gr1;
          total += grPrem;
          res_body.insertAdjacentHTML('beforeend', `<tr><td class="small-block">‚Äî –ì—Ä—É–ø–ø–∞ —Ä–∏—Å–∫–æ–≤ 1</td><td class="right">${fmt(grPrem)}</td></tr>`);
        }
        if (fin_gr23.checked){
          const lim = Number(sum_fin_gr23.value || s);
          const grPrem = lim * T_MOYA.risks.gr23;
          total += grPrem;
          res_body.insertAdjacentHTML('beforeend', `<tr><td class="small-block">‚Äî –ì—Ä—É–ø–ø–∞ —Ä–∏—Å–∫–æ–≤ 2+3</td><td class="right">${fmt(grPrem)}</td></tr>`);
        }
      }

      // movable
      if (chk_mov.checked){
        const s = Number(sum_mov.value || 0);
        if (s <= 0) { error1.textContent = '–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –¥–≤–∏–∂–∏–º–æ–≥–æ –∏–º—É—â–µ—Å—Ç–≤–∞'; return; }
        const rate = rateFromTable(T_MOYA.movable, s);
        if (!rate) { error1.textContent = '–î–≤–∏–∂–∏–º–æ–µ –∏–º—É—â–µ—Å—Ç–≤–æ: —Å—É–º–º–∞ –≤–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤'; return; }
        let prem = s * rate;
        // apply new-for-old to movable
        if (recomp) prem = prem * 1.1;
        total += prem;
        res_body.insertAdjacentHTML('beforeend', `<tr><td>–î–≤–∏–∂–∏–º–æ–µ –∏–º—É—â–µ—Å—Ç–≤–æ</td><td class="right">${fmt(prem)}</td></tr>`);
        if (mov_gr1.checked){
          const lim = Number(sum_mov_gr1.value || s);
          const grPrem = lim * T_MOYA.risks.gr1;
          total += grPrem;
          res_body.insertAdjacentHTML('beforeend', `<tr><td class="small-block">‚Äî –ì—Ä—É–ø–ø–∞ —Ä–∏—Å–∫–æ–≤ 1</td><td class="right">${fmt(grPrem)}</td></tr>`);
        }
        if (mov_gr23.checked){
          const lim = Number(sum_mov_gr23.value || s);
          const grPrem = lim * T_MOYA.risks.gr23;
          total += grPrem;
          res_body.insertAdjacentHTML('beforeend', `<tr><td class="small-block">‚Äî –ì—Ä—É–ø–ø–∞ —Ä–∏—Å–∫–æ–≤ 2+3</td><td class="right">${fmt(grPrem)}</td></tr>`);
        }
      }

      // GO
      if (chk_go.checked){
        const s = Number(sum_go.value || 0);
        if (s <= 0) { error1.textContent = '–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –ì–û'; return; }
        // if only GO selected -> solo tariff
        const others = (chk_cons.checked || chk_finish.checked || chk_mov.checked);
        let rate = 0;
        if (!others) rate = T_MOYA.go.alone;
        else {
          const item = T_MOYA.go.pack.find(r => s >= r.min && s <= r.max);
          rate = item ? item.rate : 0;
        }
        if (!rate) { error1.textContent = '–ì–û: —Å—É–º–º–∞ –≤–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤'; return; }
        const prem = s * rate;
        total += prem;
        res_body.insertAdjacentHTML('beforeend', `<tr><td>–ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</td><td class="right">${fmt(prem)}</td></tr>`);
      }

      res_total.textContent = fmt(total);
    } // recalc

    // init hide blocks
    showHide(blk_cons, false); showHide(blk_finish, false); showHide(blk_mov, false); showHide(blk_go, false);
  </script>
</body>
</html>
